language: python

python:
  - "3.6"

addons:
   coverity_scan:
     project:
       name: bang-olufsen/hdlcpp
     notification_email: jfd@bang-olufsen.dk
     build_command_prepend: cmake -DBUILD_EXTERNAL=1 -DCMAKE_TOOLCHAIN_FILE=cmake/gcc.cmake
     build_command: make
     branch_pattern: error-handling

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
  - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
  - sudo apt-get update -qq

install:
  - sudo apt-get install -qq lcov libboost-test-dev lcov python-dev g++-7
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 60 --slave /usr/bin/g++ g++ /usr/bin/g++-7

script: 
  - ./build.sh
  - bash <(curl -s https://codecov.io/bash) -X gcov -X fix -f .build-x86/coverage.info
